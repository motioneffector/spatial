<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Working with Layers - @motioneffector/spatial</title>
  <link rel="stylesheet" href="../demo-files/demo.css">
  <link rel="stylesheet" href="manual.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', () => hljs.highlightAll());</script>
</head>
<body>
  <div class="page">
    <header class="header">
      <h1 class="header-title">@motioneffector/spatial</h1>
      <p class="header-description">Documentation</p>
      <nav class="header-links">
        <a href="../index.html" class="header-link">Demo</a>
        <a href="https://www.npmjs.com/package/@motioneffector/spatial" class="header-link">npm</a>
        <a href="https://github.com/motioneffector/spatial" class="header-link">GitHub</a>
      </nav>
    </header>

    <div class="manual-layout">
      <aside class="manual-sidebar">
        <nav class="sidebar-nav">
<p><strong><a href="index.html">@motioneffector/spatial</a></strong></p>
<p><strong>Getting Started</strong></p>
<ul>
<li><a href="installation.html">Installation</a></li>
<li><a href="your-first-map.html">Your First Map</a></li>
</ul>
<p><strong>Core Concepts</strong></p>
<ul>
<li><a href="concept-nodes-and-connections.html">Nodes and Connections</a></li>
<li><a href="concept-directions.html">Directions</a></li>
<li><a href="concept-gates.html">Gates</a></li>
<li><a href="concept-traversal-and-pathfinding.html">Traversal and Pathfinding</a></li>
<li><a href="concept-spatial-features.html">Spatial Features</a></li>
</ul>
<p><strong>Guides</strong></p>
<ul>
<li><a href="guide-adding-gates-and-locked-doors.html">Adding Gates and Locked Doors</a></li>
<li><a href="guide-pathfinding.html">Pathfinding</a></li>
<li><a href="guide-working-with-layers.html">Working with Layers</a></li>
<li><a href="guide-custom-directions.html">Custom Directions</a></li>
<li><a href="guide-saving-and-loading-graphs.html">Saving and Loading Graphs</a></li>
<li><a href="guide-reacting-to-graph-changes.html">Reacting to Graph Changes</a></li>
<li><a href="guide-analyzing-graph-structure.html">Analyzing Graph Structure</a></li>
</ul>
<p><strong>API Reference</strong></p>
<ul>
<li><a href="api-graph-creation-and-types.html">Graph Creation and Types</a></li>
<li><a href="api-node-management.html">Node Management</a></li>
<li><a href="api-connection-management.html">Connection Management</a></li>
<li><a href="api-gate-management.html">Gate Management</a></li>
<li><a href="api-pathfinding.html">Pathfinding</a></li>
<li><a href="api-spatial-features.html">Spatial Features</a></li>
<li><a href="api-direction-utilities.html">Direction Utilities</a></li>
<li><a href="api-graph-analysis.html">Graph Analysis</a></li>
<li><a href="api-events.html">Events</a></li>
<li><a href="api-serialization.html">Serialization</a></li>
</ul>

        </nav>
      </aside>

      <main class="manual-content">
        <article class="manual-article">
<h1>Working with Layers</h1>
<p>Model multi-floor buildings, underground areas, and stacked spaces using layers. Each layer is an independent vertical level where the same (x, y) coordinates can exist without conflict.</p>
<h2>Prerequisites</h2>
<p>Before starting, you should:</p>
<ul>
<li><a href="concept-nodes-and-connections.html">Understand nodes and connections</a></li>
<li><a href="concept-directions.html">Understand directions</a> (especially UP/DOWN)</li>
</ul>
<h2>Overview</h2>
<p>We&#39;ll work with layers by:</p>
<ol>
<li>Creating nodes on different layers</li>
<li>Connecting floors with UP/DOWN directions</li>
<li>Querying nodes by layer</li>
<li>Using tiles with layer-aware positioning</li>
</ol>
<h2>Step 1: Create Nodes on Layers</h2>
<p>Specify the <code>layer</code> option when creating nodes. Layer defaults to 1 if not specified.</p>
<pre><code class="language-typescript">import { createSpatialGraph, Direction } from &#39;@motioneffector/spatial&#39;

const graph = createSpatialGraph()

// Ground floor (layer 1 - the default)
graph.createNode(&#39;lobby&#39;, { name: &#39;Hotel Lobby&#39;, layer: 1 })
graph.createNode(&#39;restaurant&#39;, { name: &#39;Restaurant&#39;, layer: 1 })

// Second floor (layer 2)
graph.createNode(&#39;room-201&#39;, { name: &#39;Room 201&#39;, layer: 2 })
graph.createNode(&#39;room-202&#39;, { name: &#39;Room 202&#39;, layer: 2 })

// Basement (layer 0)
graph.createNode(&#39;storage&#39;, { name: &#39;Storage Room&#39;, layer: 0 })
graph.createNode(&#39;boiler-room&#39;, { name: &#39;Boiler Room&#39;, layer: 0 })
</code></pre>
<p>Each layer is independent—you can have different room layouts on each floor.</p>
<h2>Step 2: Connect Floors Vertically</h2>
<p>Use UP and DOWN directions to link floors. Create a stairwell or elevator that spans multiple floors.</p>
<pre><code class="language-typescript">// Create stairwell nodes on each floor
graph.createNode(&#39;stairs-0&#39;, { name: &#39;Basement Stairs&#39;, layer: 0 })
graph.createNode(&#39;stairs-1&#39;, { name: &#39;Ground Floor Stairs&#39;, layer: 1 })
graph.createNode(&#39;stairs-2&#39;, { name: &#39;Second Floor Stairs&#39;, layer: 2 })

// Connect stairwells vertically
graph.connect(&#39;stairs-0&#39;, Direction.UP, &#39;stairs-1&#39;)
graph.connect(&#39;stairs-1&#39;, Direction.UP, &#39;stairs-2&#39;)

// Connect stairwells to rooms on each floor
graph.connect(&#39;stairs-0&#39;, Direction.EAST, &#39;storage&#39;)
graph.connect(&#39;stairs-1&#39;, Direction.EAST, &#39;lobby&#39;)
graph.connect(&#39;stairs-2&#39;, Direction.EAST, &#39;room-201&#39;)
</code></pre>
<p>Now players can navigate from the basement to the second floor via the stairwell.</p>
<h2>Step 3: Query Nodes by Layer</h2>
<p>Find all nodes on a specific floor.</p>
<pre><code class="language-typescript">const groundFloor = graph.getNodesInLayer(1)
console.log(groundFloor)  // [&#39;lobby&#39;, &#39;restaurant&#39;, &#39;stairs-1&#39;]

const basement = graph.getNodesInLayer(0)
console.log(basement)  // [&#39;storage&#39;, &#39;boiler-room&#39;, &#39;stairs-0&#39;]
</code></pre>
<p>This is useful for floor-specific UI, minimap rendering, or layer-based game logic.</p>
<h2>Step 4: Use Tiles with Layers</h2>
<p>When nodes have tile positions, include the layer to avoid conflicts.</p>
<pre><code class="language-typescript">// Same coordinates, different floors
graph.createNode(&#39;kitchen-ground&#39;, {
  name: &#39;Kitchen&#39;,
  tiles: [{ x: 5, y: 3 }],
  layer: 1
})

graph.createNode(&#39;bedroom-above&#39;, {
  name: &#39;Master Bedroom&#39;,
  tiles: [{ x: 5, y: 3 }],
  layer: 2
})

// Query by position and layer
console.log(graph.getNodeAt(5, 3, 1))  // &#39;kitchen-ground&#39;
console.log(graph.getNodeAt(5, 3, 2))  // &#39;bedroom-above&#39;

// Default layer is 1
console.log(graph.getNodeAt(5, 3))     // &#39;kitchen-ground&#39;
</code></pre>
<h2>Complete Example</h2>
<pre><code class="language-typescript">import { createSpatialGraph, Direction } from &#39;@motioneffector/spatial&#39;

const graph = createSpatialGraph()

// === BASEMENT (Layer 0) ===
graph.createNode(&#39;basement-hall&#39;, { layer: 0 })
graph.createNode(&#39;wine-cellar&#39;, { layer: 0 })
graph.createNode(&#39;basement-stairs&#39;, { layer: 0 })

graph.connect(&#39;basement-hall&#39;, Direction.WEST, &#39;wine-cellar&#39;)
graph.connect(&#39;basement-hall&#39;, Direction.EAST, &#39;basement-stairs&#39;)

// === GROUND FLOOR (Layer 1) ===
graph.createNode(&#39;entrance&#39;, { layer: 1 })
graph.createNode(&#39;kitchen&#39;, { layer: 1 })
graph.createNode(&#39;dining-room&#39;, { layer: 1 })
graph.createNode(&#39;ground-stairs&#39;, { layer: 1 })

graph.connect(&#39;entrance&#39;, Direction.NORTH, &#39;dining-room&#39;)
graph.connect(&#39;dining-room&#39;, Direction.WEST, &#39;kitchen&#39;)
graph.connect(&#39;dining-room&#39;, Direction.EAST, &#39;ground-stairs&#39;)

// === SECOND FLOOR (Layer 2) ===
graph.createNode(&#39;upstairs-hall&#39;, { layer: 2 })
graph.createNode(&#39;master-bedroom&#39;, { layer: 2 })
graph.createNode(&#39;guest-room&#39;, { layer: 2 })
graph.createNode(&#39;upper-stairs&#39;, { layer: 2 })

graph.connect(&#39;upstairs-hall&#39;, Direction.WEST, &#39;master-bedroom&#39;)
graph.connect(&#39;upstairs-hall&#39;, Direction.EAST, &#39;guest-room&#39;)
graph.connect(&#39;upstairs-hall&#39;, Direction.SOUTH, &#39;upper-stairs&#39;)

// === VERTICAL CONNECTIONS ===
graph.connect(&#39;basement-stairs&#39;, Direction.UP, &#39;ground-stairs&#39;)
graph.connect(&#39;ground-stairs&#39;, Direction.UP, &#39;upper-stairs&#39;)

// Find path from wine cellar to master bedroom
const path = graph.findPath(&#39;wine-cellar&#39;, &#39;master-bedroom&#39;)
console.log(path)
// [&#39;wine-cellar&#39;, &#39;basement-hall&#39;, &#39;basement-stairs&#39;,
//  &#39;ground-stairs&#39;, &#39;upper-stairs&#39;, &#39;upstairs-hall&#39;, &#39;master-bedroom&#39;]

// Get all basement rooms
const basement = graph.getNodesInLayer(0)
console.log(&#39;Basement rooms:&#39;, basement)
</code></pre>
<h2>Variations</h2>
<h3>Elevator Shaft</h3>
<p>A single node that spans multiple floors (using multi-tile with different layers).</p>
<pre><code class="language-typescript">// Elevator as a concept - represent on each floor
graph.createNode(&#39;elevator-0&#39;, { name: &#39;Elevator (B)&#39;, layer: 0 })
graph.createNode(&#39;elevator-1&#39;, { name: &#39;Elevator (1)&#39;, layer: 1 })
graph.createNode(&#39;elevator-2&#39;, { name: &#39;Elevator (2)&#39;, layer: 2 })

// Connect all floors directly
graph.connect(&#39;elevator-0&#39;, Direction.UP, &#39;elevator-1&#39;)
graph.connect(&#39;elevator-1&#39;, Direction.UP, &#39;elevator-2&#39;)
graph.connect(&#39;elevator-0&#39;, Direction.UP, &#39;elevator-2&#39;)  // Express to top
</code></pre>
<h3>Hidden Basement</h3>
<p>Basement that must be discovered.</p>
<pre><code class="language-typescript">graph.connect(&#39;ground-stairs&#39;, Direction.DOWN, &#39;basement-stairs&#39;)
graph.setGate(&#39;ground-stairs&#39;, Direction.DOWN, {
  id: &#39;basement-door&#39;,
  hidden: true
})

// Player can&#39;t go down until they discover the basement entrance
</code></pre>
<h3>Layer-Specific Events</h3>
<p>React when players change floors.</p>
<pre><code class="language-typescript">graph.on(&#39;nodeCreated&#39;, (id, data) =&gt; {
  console.log(`New room on floor ${data.layer}: ${id}`)
})
</code></pre>
<h2>Troubleshooting</h2>
<h3>getNodeAt returns wrong node</h3>
<p><strong>Symptom:</strong> <code>getNodeAt(x, y)</code> returns a node from the wrong floor.</p>
<p><strong>Cause:</strong> Not specifying the layer parameter (defaults to layer 1).</p>
<p><strong>Solution:</strong> Always pass the layer when querying specific floors:</p>
<pre><code class="language-typescript">const node = graph.getNodeAt(x, y, currentFloor)
</code></pre>
<h3>Nodes not appearing in getNodesInLayer</h3>
<p><strong>Symptom:</strong> Node exists but doesn&#39;t appear in layer query.</p>
<p><strong>Cause:</strong> Node created without explicit layer (defaults to 1) or with wrong layer value.</p>
<p><strong>Solution:</strong> Check the node&#39;s actual layer:</p>
<pre><code class="language-typescript">const node = graph.getNode(&#39;my-node&#39;)
console.log(&#39;Node layer:&#39;, node?.layer)
</code></pre>
<h2>See Also</h2>
<ul>
<li><strong><a href="concept-spatial-features.html">Spatial Features</a></strong> — Tiles, layers, and zones</li>
<li><strong><a href="concept-directions.html">Directions</a></strong> — UP and DOWN directions</li>
<li><strong><a href="api-spatial-features.html">Spatial Features API</a></strong> — Full method reference</li>
</ul>

        </article>
      </main>
    </div>
  </div>
</body>
</html>
